<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°æˆ°ç©åˆ†è¨ˆç®—å™¨</title>
    <link rel="stylesheet" href="navigation.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap');
        
        body {
            font-family: 'Noto Sans TC', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }
        
        .page-container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            text-align: center;
            padding: 30px;
            margin-bottom: 0;
        }
        
        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin: 0;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .content-wrapper {
            padding: 40px;
        }
        
        .calculator-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(79, 172, 254, 0.2);
        }
        
        .section-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #4facfe;
            margin-bottom: 20px;
            text-align: left;
            position: relative;
            padding-bottom: 10px;
        }
        
        .section-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 60px;
            height: 3px;
            background: linear-gradient(90deg, #4facfe, #00f2fe);
            border-radius: 2px;
        }
        
        .progress-bar-container {
            width: 100%;
            height: 50px;
            background-color: #f0f0f0;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            position: relative;
            margin-bottom: 15px;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            border-radius: 8px;
            transition: width 0.3s ease;
            position: relative;
            box-shadow: 0 2px 10px rgba(79, 172, 254, 0.3);
        }
        
        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 16px;
            font-weight: 600;
            color: #2c3e50;
            z-index: 1;
        }
        
        .status-label {
            text-align: center;
            font-size: 18px;
            font-weight: 600;
            padding: 15px;
            color: #e74c3c;
            background: linear-gradient(135deg, #fff5f5 0%, #ffe8e8 100%);
            border-radius: 10px;
            margin-top: 10px;
        }
        
        .status-label.active {
            color: #27ae60;
            background: linear-gradient(135deg, #f0fff4 0%, #e8f8f0 100%);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
            transition: transform 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-card h3 {
            font-size: 1rem;
            font-weight: 500;
            margin-bottom: 10px;
            opacity: 0.9;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .opponents-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .star-group {
            border: 3px solid #e1e5e9;
            border-radius: 15px;
            padding: 20px;
            padding-top: 30px;
            position: relative;
            transition: all 0.3s ease;
        }
        
        .star-group:hover {
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        }
        
        .star-group.star-3 {
            background: linear-gradient(135deg, #FFF9E6 0%, #FFF5CC 100%);
            border-color: #FFD700;
        }
        
        .star-group.star-2 {
            background: linear-gradient(135deg, #F5F5F5 0%, #E8E8E8 100%);
            border-color: #C0C0C0;
        }
        
        .star-group.star-1 {
            background: linear-gradient(135deg, #FFF3E0 0%, #FFE8CC 100%);
            border-color: #CD7F32;
        }
        
        .star-group.star-0 {
            background: linear-gradient(135deg, #FAFAFA 0%, #F0F0F0 100%);
            border-color: #9E9E9E;
        }
        
        .star-group-title {
            position: absolute;
            top: -15px;
            left: 20px;
            background: white;
            padding: 5px 15px;
            font-weight: 700;
            font-size: 1rem;
            border-radius: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .star-group.star-3 .star-group-title {
            background: linear-gradient(135deg, #FFD700 0%, #FFC700 100%);
            color: white;
        }
        
        .star-group.star-2 .star-group-title {
            background: linear-gradient(135deg, #C0C0C0 0%, #A8A8A8 100%);
            color: white;
        }
        
        .star-group.star-1 .star-group-title {
            background: linear-gradient(135deg, #CD7F32 0%, #B87333 100%);
            color: white;
        }
        
        .star-group.star-0 .star-group-title {
            background: linear-gradient(135deg, #9E9E9E 0%, #858585 100%);
            color: white;
        }
        
        .opponent-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
            padding: 8px;
            background: white;
            border-radius: 10px;
            transition: all 0.2s ease;
        }
        
        .opponent-row:hover {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transform: translateX(3px);
        }
        
        .opponent-number {
            min-width: 40px;
            max-width: 40px;
            padding: 10px;
            text-align: center;
            font-weight: 700;
            font-size: 16px;
            border: 2px solid #333;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .opponent-number.star-3 {
            background: linear-gradient(135deg, #FFD700 0%, #FFC700 100%);
            color: white;
        }
        
        .opponent-number.star-2 {
            background: linear-gradient(135deg, #C0C0C0 0%, #A8A8A8 100%);
            color: white;
        }
        
        .opponent-number.star-1 {
            background: linear-gradient(135deg, #CD7F32 0%, #B87333 100%);
            color: white;
        }
        
        .opponent-number.star-0 {
            background: linear-gradient(135deg, #9E9E9E 0%, #858585 100%);
            color: white;
        }
        
        .hp-circles {
            display: flex;
            gap: 6px;
            flex: 1;
        }
        
        .hp-circle {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            border: 3px solid #34495e;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .hp-circle.active {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            box-shadow: 0 4px 10px rgba(79, 172, 254, 0.4);
        }
        
        .hp-circle.inactive {
            background: linear-gradient(135deg, #e0e0e0 0%, #bdbdbd 100%);
        }
        
        .hp-circle:hover {
            transform: scale(1.15);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }
        
        .control-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 25px;
            background: linear-gradient(135deg, #f8f9ff 0%, #e6f3ff 100%);
            border-radius: 15px;
            border: 1px solid rgba(79, 172, 254, 0.2);
            gap: 20px;
        }
        
        .info-label {
            color: #5a6c7d;
            font-size: 14px;
            font-weight: 500;
            flex: 1;
        }
        
        .reset-btn {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
            border: none;
            padding: 15px 35px;
            font-size: 16px;
            font-weight: 700;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(231, 76, 60, 0.4);
            white-space: nowrap;
        }
        
        .reset-btn:hover {
            background: linear-gradient(135deg, #c0392b 0%, #a93226 100%);
            transform: translateY(-2px);
            box-shadow: 0 12px 35px rgba(231, 76, 60, 0.5);
        }
        
        .reset-btn:active {
            transform: translateY(0);
        }
        
        @media (max-width: 768px) {
            .content-wrapper {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .opponents-container {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .control-section {
                flex-direction: column;
                text-align: center;
            }
            
            .reset-btn {
                width: 100%;
            }
            
            .hp-circle {
                width: 30px;
                height: 30px;
            }
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .calculator-section {
            animation: fadeInUp 0.6s ease-out;
        }
    </style>
</head>
<body>

    <!-- ä¸»å…§å®¹ -->
    <div class="main-content">
        <div class="page-container">
            <div class="header">
                <h1>âš”ï¸ å°æˆ°ç©åˆ†è¨ˆç®—å™¨</h1>
            </div>
            
            <div class="content-wrapper">
                <!-- ç©é»é€²åº¦å€ -->
                <div class="calculator-section">
                    <div class="section-title">ç©é»é€²åº¦</div>
                    <div class="progress-bar-container">
                        <div class="progress-bar" id="progressBar"></div>
                        <div class="progress-text" id="progressText">0.00 / 75 ç©é» (0%)</div>
                    </div>
                    <div class="status-label" id="statusLabel">ç‹€æ…‹: æœªè§¸ç™¼åŠ å€</div>
                </div>

                <!-- çµ±è¨ˆè³‡è¨Šå€ -->
                <div class="calculator-section">
                    <div class="section-title">ç•¶å‰çµ±è¨ˆ</div>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <h3>ç¸½åˆ†æ•¸</h3>
                            <div class="stat-value" id="scoreLabel">0</div>
                        </div>
                        <div class="stat-card">
                            <h3>å·²æ‰“å ´æ¬¡</h3>
                            <div class="stat-value" id="gamesLabel">0 / 100</div>
                        </div>
                        <div class="stat-card">
                            <h3>ç´¯ç©ç©é»</h3>
                            <div class="stat-value" id="pointsLabel">0.00</div>
                        </div>
                    </div>
                </div>

                <!-- å°æ‰‹å€åŸŸ -->
                <div class="calculator-section">
                    <div class="section-title">å°æ‰‹è¡€é‡è¿½è¹¤</div>
                    <div class="opponents-container" id="opponentsContainer"></div>
                </div>

                <!-- æ§åˆ¶å€ -->
                <div class="control-section">
                    <div class="info-label">ğŸ’¡ é»æ“Šåœ“åœˆè¨­å®šå‰©é¤˜è¡€é‡ | é»ç¬¬3å€‹åœˆ = å‰©3æ ¼è¡€ | é»ç¬¬5å€‹åœˆ = é‡ç½®è©²å°æ‰‹</div>
                    <button class="reset-btn" onclick="resetAll()">ğŸ”„ é‡ç½®æ‰€æœ‰å°æ‰‹</button>
                </div>
            </div>
        </div>
    </div>

    <script src="navigation.js"></script>
    <script>
        // éŠæˆ²æ•¸æ“š
        let totalPoints = 0;
        let totalScore = 0;
        let gamesPlayed = 0;
        let isDoubled = false;
        let opponentHpHistory = Array(20).fill(5);

        // æ˜Ÿç´šè³‡è¨Š
        const starInfo = {
            3: { range: [1, 5], score: 130, name: 'â­â­â­ ä¸‰æ˜Ÿ' },
            2: { range: [6, 10], score: 120, name: 'â­â­ äºŒæ˜Ÿ' },
            1: { range: [11, 15], score: 110, name: 'â­ ä¸€æ˜Ÿ' },
            0: { range: [16, 20], score: 100, name: 'ç„¡æ˜Ÿç´š' }
        };

        // è¡€é‡ç©é»å°æ‡‰
        const hpPoints = {
            5: 2.25,
            4: 1.25,
            3: 1.00,
            2: 0.25,
            1: 0.25
        };

        // åˆå§‹åŒ–ç•Œé¢
        function initUI() {
            const container = document.getElementById('opponentsContainer');
            
            [3, 2, 1, 0].forEach(starLevel => {
                const starGroup = createStarGroup(starLevel);
                container.appendChild(starGroup);
            });
        }

        // å‰µå»ºæ˜Ÿç´šç¾¤çµ„
        function createStarGroup(starLevel) {
            const [start, end] = starInfo[starLevel].range;
            const groupDiv = document.createElement('div');
            groupDiv.className = `star-group star-${starLevel}`;
            
            const title = document.createElement('div');
            title.className = 'star-group-title';
            title.textContent = starInfo[starLevel].name;
            groupDiv.appendChild(title);

            for (let number = start; number <= end; number++) {
                const opponentRow = createOpponentRow(number, starLevel);
                groupDiv.appendChild(opponentRow);
            }

            return groupDiv;
        }

        // å‰µå»ºå°æ‰‹è¡Œ
        function createOpponentRow(number, starLevel) {
            const row = document.createElement('div');
            row.className = 'opponent-row';

            const numberDiv = document.createElement('div');
            numberDiv.className = `opponent-number star-${starLevel}`;
            numberDiv.textContent = number;
            row.appendChild(numberDiv);

            const circlesDiv = document.createElement('div');
            circlesDiv.className = 'hp-circles';

            for (let i = 1; i <= 5; i++) {
                const circle = createHpCircle(number, i);
                circlesDiv.appendChild(circle);
            }

            row.appendChild(circlesDiv);
            return row;
        }

        // å‰µå»ºè¡€é‡åœ“åœˆ
        function createHpCircle(opponentNumber, position) {
            const circle = document.createElement('div');
            circle.className = 'hp-circle active';
            circle.dataset.opponent = opponentNumber;
            circle.dataset.position = position;
            circle.onclick = () => onCircleClick(opponentNumber, position);
            return circle;
        }

        // åœ“åœˆé»æ“Šäº‹ä»¶
        function onCircleClick(opponentNumber, position) {
            const index = opponentNumber - 1;
            const previousHp = opponentHpHistory[index];
            const currentHp = position;

            if (currentHp === previousHp) return;

            let pointsGained = 0;
            let scoreGained = 0;
            let gamesIncrement = 0;

            // è¡€é‡æ¸›å°‘
            if (currentHp < previousHp) {
                for (let hp = previousHp; hp > currentHp; hp--) {
                    if (hpPoints[hp]) {
                        pointsGained += hpPoints[hp];
                        gamesIncrement += 1;
                    }
                }

                // è¢«æ‰“æ•—
                if (currentHp === 0 && previousHp > 0) {
                    const starLevel = getStarLevel(opponentNumber);
                    const baseScore = starInfo[starLevel].score;
                    const multiplier = isDoubled ? 2 : 1;
                    scoreGained = baseScore * multiplier;
                }
            }
            // è¡€é‡å¢åŠ (æ¢å¾©)
            else {
                for (let hp = currentHp; hp > previousHp; hp--) {
                    if (hpPoints[hp]) {
                        pointsGained -= hpPoints[hp];
                        gamesIncrement -= 1;
                    }
                }

                // å¾0æ¢å¾©
                if (previousHp === 0) {
                    const starLevel = getStarLevel(opponentNumber);
                    const baseScore = starInfo[starLevel].score;
                    const multiplier = isDoubled ? 2 : 1;
                    scoreGained = -baseScore * multiplier;
                }
            }

            // æ›´æ–°ç¸½è¨ˆ
            totalPoints += pointsGained;
            totalScore += scoreGained;
            gamesPlayed += gamesIncrement;
            opponentHpHistory[index] = currentHp;

            // æª¢æŸ¥åŠ å€è§¸ç™¼
            if (!isDoubled && totalPoints >= 75) {
                isDoubled = true;
                updateStatus(true);
            } else if (isDoubled && totalPoints < 75) {
                isDoubled = false;
                updateStatus(false);
            }

            // æ›´æ–°UI
            updateOpponentDisplay(opponentNumber, currentHp);
            updateDisplay();
        }

        // ç²å–æ˜Ÿç´š
        function getStarLevel(opponentNumber) {
            for (const [starLevel, info] of Object.entries(starInfo)) {
                const [start, end] = info.range;
                if (opponentNumber >= start && opponentNumber <= end) {
                    return parseInt(starLevel);
                }
            }
            return 0;
        }

        // æ›´æ–°å°æ‰‹é¡¯ç¤º
        function updateOpponentDisplay(opponentNumber, currentHp) {
            const circles = document.querySelectorAll(`[data-opponent="${opponentNumber}"]`);
            circles.forEach(circle => {
                const position = parseInt(circle.dataset.position);
                circle.className = position <= currentHp ? 'hp-circle active' : 'hp-circle inactive';
            });
        }

        // æ›´æ–°ç‹€æ…‹
        function updateStatus(active) {
            const statusLabel = document.getElementById('statusLabel');
            if (active) {
                statusLabel.textContent = 'ç‹€æ…‹: âœ“ å·²è§¸ç™¼åŠ å€!';
                statusLabel.classList.add('active');
            } else {
                statusLabel.textContent = 'ç‹€æ…‹: æœªè§¸ç™¼åŠ å€';
                statusLabel.classList.remove('active');
            }
        }

        // æ›´æ–°é¡¯ç¤º
        function updateDisplay() {
            // æ›´æ–°é€²åº¦æ¢
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');
            const progressValue = Math.min(totalPoints, 75);
            const percentage = (progressValue / 75) * 100;
            
            progressBar.style.width = percentage + '%';
            
            if (totalPoints > 75) {
                progressText.textContent = `${totalPoints.toFixed(2)} / 75 ç©é» (å·²é”æˆ)`;
            } else {
                progressText.textContent = `${totalPoints.toFixed(2)} / 75 ç©é» (${Math.round(percentage)}%)`;
            }

            // æ›´æ–°çµ±è¨ˆ
            document.getElementById('scoreLabel').textContent = totalScore.toLocaleString();
            document.getElementById('gamesLabel').textContent = `${gamesPlayed} / 100`;
            document.getElementById('pointsLabel').textContent = totalPoints.toFixed(2);
        }

        // é‡ç½®æ‰€æœ‰
        function resetAll() {
            totalPoints = 0;
            totalScore = 0;
            gamesPlayed = 0;
            isDoubled = false;
            opponentHpHistory = Array(20).fill(5);

            // é‡ç½®æ‰€æœ‰åœ“åœˆ
            for (let i = 1; i <= 20; i++) {
                updateOpponentDisplay(i, 5);
            }

            updateStatus(false);
            updateDisplay();
        }

        // é é¢è¼‰å…¥æ™‚åˆå§‹åŒ–
        window.onload = function() {
            initUI();
            updateDisplay();
        };
    </script>
</body>
</html>